"use strict";(()=>{var e={};e.id=154,e.ids=[154],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},98432:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>q,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>g,staticGenerationAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{POST:()=>w});var a=t(49303),i=t(88716),o=t(60670),n=t(87070),l=t(75571),u=t(28855),p=t(75826),c=t(14564),d=t(55315);let m=require("fs/promises"),_=require("@aws-sdk/client-s3");async function f({buffer:e,originalName:r}){let t=`${Date.now()}_${r}`.replace(/[^a-zA-Z0-9._-]/g,"_"),s=function(){let e=process.env.S3_REGION||"auto",r=process.env.S3_ENDPOINT,t=process.env.S3_ACCESS_KEY_ID,s=process.env.S3_SECRET_ACCESS_KEY;return t&&s&&process.env.S3_BUCKET?new _.S3Client({region:e,endpoint:r||void 0,credentials:{accessKeyId:t,secretAccessKey:s}}):null}();if(s){let a=process.env.S3_BUCKET,i=`resumes/${t}`;await s.send(new _.PutObjectCommand({Bucket:a,Key:i,Body:e,ContentType:"application/octet-stream"}));let o=process.env.S3_PUBLIC_BASE_URL;return{provider:"s3",fileName:r,url:o?`${o.replace(/\/$/,"")}/${i}`:`s3://${a}/${i}`}}let a=d.join(process.cwd(),"public","uploads");return await m.mkdir(a,{recursive:!0}),await m.writeFile(d.join(a,t),e),{provider:"local",fileName:r,url:`/uploads/${t}`}}var h=t(44721);async function w(e){let r=await (0,l.getServerSession)(u.Lz);if(!r?.user?.email)return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.formData(),s=t.get("orderId"),a=t.get("fullName")||"",i=t.get("phone")||"",o=t.get("linkedinUrl")||"",d=t.get("paymentRef")||"",m=t.get("resume"),_=c.jE.safeParse({fullName:a,phone:i,linkedinUrl:o});if(!_.success)return n.NextResponse.json({error:_.error.issues[0]?.message||"Invalid profile"},{status:400});let w=c.Lp.safeParse({paymentRef:d});if(!w.success)return n.NextResponse.json({error:w.error.issues[0]?.message||"Invalid payment ref"},{status:400});let v=await p._.user.findUnique({where:{email:r.user.email}}),y=await p._.order.findUnique({where:{id:s},include:{items:!0}});if(!y||y.userId!=v.id)return n.NextResponse.json({error:"Order not found"},{status:404});let E=null,g=null,x="local";if(m&&"object"==typeof m&&m.name){let e=await m.arrayBuffer(),r=Buffer.from(e),t=await f({buffer:r,originalName:m.name});E=t.fileName,g=t.url,x=t.provider,await p._.resume.create({data:{userId:v.id,orderId:s,fileName:E,fileUrl:g,storageProvider:x}})}let q=await p._.order.update({where:{id:s},data:{fullName:a,phone:i,linkedinUrl:o||null,resumeFileName:E,resumeFileUrl:g,paymentRef:d,status:"payment_submitted"}});return await (0,h.C)({to:r.user.email,subject:"HOPE_IRL: We received your order",html:`<div style="font-family:Arial,sans-serif"><h2>Order received âœ…</h2><p>Thanks for choosing HOPE_IRL. Your request has been received and our team will connect soon.</p><p><b>Status:</b> payment_submitted</p><p><b>Order ID:</b> ${q.id}</p></div>`}),n.NextResponse.json({ok:!0})}let v=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/checkout/submit/route",pathname:"/api/checkout/submit",filename:"route",bundlePath:"app/api/checkout/submit/route"},resolvedPagePath:"C:\\Users\\Subra\\Downloads\\hope_irl_cloud_app_consultancy_grade\\hope_irl_cloud_app\\app\\api\\checkout\\submit\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:E,serverHooks:g}=v,x="/api/checkout/submit/route";function q(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:E})}},28855:(e,r,t)=>{t.d(r,{HT:()=>d,Lz:()=>c,a4:()=>d});var s=t(75571),a=t(77234),i=t(53797),o=t(75826),n=t(42023);let l=s?.default??s,u=a?.default??a,p=i?.default??i,c={session:{strategy:"jwt"},pages:{signIn:"/auth/login"},providers:[..."string"==typeof process.env.GOOGLE_CLIENT_ID&&"string"==typeof process.env.GOOGLE_CLIENT_SECRET&&process.env.GOOGLE_CLIENT_ID.trim().length>0&&process.env.GOOGLE_CLIENT_SECRET.trim().length>0?[u({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})]:[],p({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){let r=e?.email?.toLowerCase(),t=e?.password;if(!r||!t)return null;let s=await o._.user.findUnique({where:{email:r}});return s&&s.passwordHash&&await n.compare(t,s.passwordHash)?{id:s.id,email:s.email,name:s.name,image:s.image,role:s.role}:null}})],callbacks:{async jwt({token:e,user:r}){if(r&&(e.role=r.role),e?.email){let r=await o._.user.findUnique({where:{email:e.email}});r&&(e.role=r.role)}return e},session:async({session:e,token:r})=>(e?.user&&(e.user.role=r.role),e)},events:{async createUser({user:e}){e?.email&&await o._.user.update({where:{id:e.id},data:{email:e.email.toLowerCase()}})}}},d=l(c)},44721:(e,r,t)=>{t.d(r,{C:()=>s});async function s({to:e,subject:r,html:t}){let s=process.env.RESEND_API_KEY,a=process.env.EMAIL_FROM||"HOPE_IRL <no-reply@hope-irl.local>";if(!s)return console.log("[email:mock]",{to:e,subject:r,from:a}),{ok:!0,mocked:!0};try{let i=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({from:a,to:e,subject:r,html:t})}),o=await i.json().catch(()=>({}));if(!i.ok)return console.error("[email:error]",i.status,o),{ok:!1,status:i.status,data:o};return{ok:!0,data:o}}catch(e){return console.error("[email:exception]",e),{ok:!1,error:"email_send_failed"}}}},75826:(e,r,t)=>{t.d(r,{_:()=>a});var s=t(53524);let a=globalThis.prisma||new s.PrismaClient({log:["error"]})},14564:(e,r,t)=>{t.d(r,{Lp:()=>o,if:()=>a,jE:()=>i});var s=t(21067);let a=s.Ry({name:s.Z_().min(2,"Name is required"),email:s.Z_().email(),password:s.Z_().min(8,"Min 8 characters"),phone:s.Z_().optional(),linkedinUrl:s.Z_().url().optional().or(s.i0(""))}),i=s.Ry({fullName:s.Z_().min(2,"Full name is required"),phone:s.Z_().min(6,"Phone is required"),linkedinUrl:s.Z_().url().optional().or(s.i0(""))}),o=s.Ry({paymentRef:s.Z_().min(3,"Payment reference is required")})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,776,734,972,67],()=>t(98432));module.exports=s})();